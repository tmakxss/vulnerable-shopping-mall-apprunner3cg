version: 1.0
runtime: python311

build:
  commands:
    build:
      - echo "noop build"

run:
  runtime-version: 3.11
  pre-run:
    - pip3 install -r requirements.txt

  command: python3 -m flask --app api.index:app run --host=0.0.0.0 --port 8080

  network:
    port: 8080

  environment-variables:
    # --- Runtime ---
    FLASK_ENV: production
    PYTHONPATH: /app/lib
    SECRET_KEY: "CSCVSMTEST1021CSCVSMTEST1021CSCVSMTEST1021"

    # --- DB種別 ---
    DB_TYPE: postgresql

    # --- Supabase ---
    SUPABASE_URL: "https://fwotktpzxkoiplcjzeoc.supabase.co"
    SUPABASE_KEY: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ3b3RrdHB6eGtvaXBsY2p6ZW9jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3NzU1NjMsImV4cCI6MjA3NTM1MTU2M30.R-ZvT3v-E76kBDaB3_aVdGVlLG435n0QBMSMRWS_leQ"

    # --- DB接続（プーリング推奨）---
    DATABASE_URL: "postgresql://postgres:CSCVSMTEST1021@aws-1-ap-northeast-1.pooler.supabase.com:6543/postgres"
    SUPABASE_DB_URL: "postgresql://postgres:CSCVSMTEST1021@aws-1-ap-northeast-1.pooler.supabase.com:6543/postgres"

    # --- 直接接続（必要なら。無くても可）---
    DIRECT_URL: "postgresql://postgres:CSCVSMTEST1021@db.fwotktpzxkoiplcjzeoc.supabase.co:5432/postgres"
