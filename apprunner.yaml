version: 1.0
runtime: python311

build:
  commands:
    build:
      - echo "noop build"

run:
  runtime-version: 3.11
  pre-run:
    - pip3 install -r requirements.txt

  command: python3 -m flask --app api.index:app run --host=0.0.0.0 --port 8080

  network:
    port: 8080

  env:
    - name: FLASK_ENV
      value: production
    - name: PYTHONPATH
      value: /app/lib
    - name: SECRET_KEY
      value: "CSCVSMTEST1021CSCVSMTEST1021CSCVSMTEST1021CSCVSMTEST1021"

    - name: DB_TYPE
      value: postgresql

    - name: SUPABASE_URL
      value: "https://fwotktpzxkoiplcjzeoc.supabase.co"
    - name: SUPABASE_KEY
      value: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ3b3RrdHB6eGtvaXBsY2p6ZW9jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3NzU1NjMsImV4cCI6MjA3NTM1MTU2M30.R-ZvT3v-E76kBDaB3_aVdGVlLG435n0QBMSMRWS_leQ"

    # 接続はプーリング(6543)＋SSL必須
    - name: DATABASE_URL
      value: "postgresql://postgres.fwotktpzxkoiplcjzeoc:CSCVSMTEST1021@aws-1-ap-northeast-1.pooler.supabase.com:6543/postgres?sslmode=require"
    
    - name: SUPABASE_DB_URL
      value: "postgresql://postgres.fwotktpzxkoiplcjzeoc:CSCVSMTEST1021@aws-1-ap-northeast-1.pooler.supabase.com:6543/postgres?sslmode=require"

    # 直接接続（必要時のみ利用）
    - name: DIRECT_URL
      value: "postgresql://postgres:CSCVSMTEST1021@db.fwotktpzxkoiplcjzeoc.supabase.co:5432/postgres?sslmode=require"
