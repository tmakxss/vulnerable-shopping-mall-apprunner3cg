version: 1.0
runtime: python311

build:
  # build.commands が必須扱いになるケースを回避するため no-op を明示
  commands:
    build:
      - echo "noop build"

run:
  runtime-version: 3.11
  pre-run:
    - pip3 install -r requirements.txt

  # Flask アプリを直接起動（api/index.py の app オブジェクト）
  command: python3 -m flask --app api.index:app run --host=0.0.0.0 --port 8080

  network:
    port: 8080

  environment-variables:
    # --- Flask / Runtime ---
    FLASK_ENV: production
    PYTHONPATH: /app/lib

    # --- Database / Supabase 接続 ---
    DB_TYPE: postgresql
    SUPABASE_URL: "https://fwotktpzxkoiplcjzeoc.supabase.co"
    SUPABASE_KEY: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ3b3RrdHB6eGtvaXBsY2p6ZW9jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3NzU1NjMsImV4cCI6MjA3NTM1MTU2M30.R-ZvT3v-E76kBDaB3_aVdGVlLG435n0QBMSMRWS_leQ"
    SUPABASE_DB_URL: "postgresql://postgres.fwotktpzxkoiplcjzeoc:Csctest1007!@aws-1-ap-northeast-1.pooler.supabase.com:6543/postgres?sslmode=require"

    # --- アプリケーション用秘密鍵 ---
    SECRET_KEY: "your-secret-key-for-waf-version"
